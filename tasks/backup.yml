- name: "Decide filename"
  set_fact:
    filename: "{{inventory_hostname}}_{{ansile_date_time.date}}_{{item}}.tar.bz2"

- name: "Copy volume content"
  command: docker run --rm -i -v {{ item }}:/volume:ro -v /tmp/backup/{{ item }}:/backup {{ alpine_image }} cp -a /volume/. /backup

- name: "Compress back ups"
  command: tar -cjf /tmp/backup/{{ filename }} -C /tmp/backup/{{item}} ./

- name: "Retrieve back up"
  tags: vol_backup
  fetch:
    flat: True
    src: "/tmp/backup/{{ filename }}"
    dest: "{{playbook_dir}}/{{filename}}"

